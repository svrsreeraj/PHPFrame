{assign var="actionReturn" value=$obj->actionReturn}

{literal}
<script type="text/javascript" src="js/highslide/highslide.js"></script>
<link rel="stylesheet" type="text/css" href="js/highslide/highslide.css" />
<link type="text/css" href="js/ui/themes/base/jquery.ui.all.css" rel="stylesheet" />
<script type="text/javascript" src="js/ui/ui/jquery.ui.core.js"></script>
<script type="text/javascript" src="js/ui/ui/jquery.ui.widget.js"></script>
<script type="text/javascript" src="js/ui/ui/jquery.ui.mouse.js"></script>
<script type="text/javascript" src="js/ui/ui/jquery.ui.draggable.js"></script>
<script type="text/javascript" src="js/ui/ui/jquery.ui.sortable.js"></script>

<script type="text/javascript">
function getcombo(cid,changeId)
	{
		$("#"+changeId).html("Loading...");
		$.ajax({
			   type	: "GET",
			   url	: "customers.php",
			   data	: "actionvar=Getstatecombo&cid="+cid,
			   dataType: "html",
			   success: function(msg){
				   $("#"+changeId).html(msg); 	
				}
			 });
	}
$(document).ready(function() {
	$("#customerdetails").tooltip();
	$("#totalrefreral").tooltip();
	$("#totaljoined").tooltip();
	$("#totalnotjoined").tooltip();
	$("#productiveusers").tooltip();
	$("#customerdetails").tooltip();
	$("#image").tooltip();
	$("#totalsitepoint").tooltip();
	$("#balancesitepoint").tooltip();
	$("#usedsitepoints").tooltip();
	$("#totalvoteddeal").tooltip();
	$("#votedandpurchsed").tooltip();
	$("#voednotpurchased").tooltip();
	
	$("#txt_join_from").datepicker();
	$("#txt_join_from").datepicker('option',
	{
		showAnim:'show',
		dateFormat:'yy-mm-dd',
		changeMonth: true,
		changeYear: true,
		//minDate: -20, 
		//maxDate: '+1M +10D',
		showOtherMonths: true, 
		selectOtherMonths: true,
		defaultDate:'2010-11-24',
		//yearRange:'c-50:c+10',
		autoSize:false
	});

	$("#txt_join_to").datepicker();
	$("#txt_join_to").datepicker('option',
	{
		showAnim:'show',
		dateFormat:'yy-mm-dd',
		changeMonth: true,
		changeYear: true,
		//minDate: -20, 
		//maxDate: '+1M +10D',
		showOtherMonths: true, 
		selectOtherMonths: true,
		defaultDate:'2010-11-24',
		//yearRange:'c-50:c+10',
		autoSize:false
	});

});
</script>

<link type="text/css" href="js/ui/themes/base/jquery.ui.all.css" rel="stylesheet" />
<script type="text/javascript" src="js/ui/ui/jquery.ui.core.js"></script>
<script type="text/javascript" src="js/ui/ui/jquery.ui.widget.js"></script>
<script type="text/javascript" src="js/ui/ui/jquery.ui.datepicker.js"></script>

{/literal}

<form action="" name="fromName" method="post" enctype="multipart/form-data">
<table width="100%" border="0" cellpadding="0" cellspacing="0" class="table_style">

{if $obj->getPageError()}
<tr>
	<td class="errorMessage">{$obj->popPageError()}</td>
</tr>
{/if}
<tr>
	<td class="pageHead"><span id="customerdetails"><strong>Customers {if ($obj->currentAction	==	"Listing")}Listing{/if}{if ($obj->currentAction	==	"Editform")}Edit : {$actionReturn.data.fname}{/if} </strong></span></td>
</tr>
{if ($obj->currentAction	==	"Editform")}
<tr>
	<td>&nbsp;</td>
</tr>
<tr>
	<td>
		<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="formTable">
			<tr>
				<th colspan="2">Manage Customers</th>
			</tr>
			<tr>
				<td width="150">First Name </td>
				<td><input type="text"  name="fname" valtype="emptyCheck-Please enter the  first name "  value="{$actionReturn.data.fname}" id="fnameId" class="alphaNumeric" /></td>
			</tr>
			<tr>
				<td>Last Name </td>
				<td><input type="text" valtype="emptyCheck-Please enter the last name"  name="lname" value="{$actionReturn.data.lname}" id="lanmeId" class="alphaNumeric" /></td>
			</tr>
			<tr>
				<td>Email</td>
				<td><input type="text" valtype="emptyCheck-Please enter the Email address|emailCheck-please enter a valid Email address"   name="email" value="{$actionReturn.data.email}" id="emailId"  class="emailValidate" /></td>
			</tr>
			<tr>
				<td id="image">Image</td>
					<td><input type="file"  name="fileImage" value="{$actionReturn.data.image}" id="fileImageId" />&nbsp;
					{if $actionReturn.data.image}
						<a  href="../images/customers/{$actionReturn.data.image}" class="highslide" onclick="return hs.expand(this)">
						<img src="../images/customers/thumb/{$actionReturn.data.image}" width="25" height="25" ; />
						</a>{/if}
						</td>
				</tr>
				
									<tr>
				<td>Subcategory </td>
				<td>{$actionReturn.subcat_combo}</td>
			</tr>			
			<tr>
				<td>Password</td>
				<td><input type="password" valtype="emptyCheck-Please enter the password" name="password" value="{$actionReturn.data.password}" id="passwordId"   /></td>
			</tr>
		
			<tr>
				<td>Country</td>
				<td>{$actionReturn.country_combo}</td>
			</tr>
	
			<tr>
				<td>State</td>
				<td><div id="stateDivId">{$actionReturn.state_combo}</div></td>
			</tr>	
		
			<tr>
				<td>Zip</td>
				<td><input type="text" valtype="emptyCheck-Please enter the zip code " name="zip" value="{$actionReturn.data.zip}" id="zipId" class="validatezip"/></td>
			</tr>
		
			<tr>
				<td>Mobile</td>
				<td><input type="text" valtype="emptyCheck-Please enter the mobile number|checkNumber-Please enter a valid number"  name="mobile" value="{$actionReturn.data.mobile}" id="mobileId" class="nummberOnly"  maxlength="15" /></td>
			</tr>
	
			<tr>
				<td>Email Update</td>
				<td>				
				<input type="checkbox"  name="email_update"  id="email_updateId" value="1" {if $actionReturn.data.email_update	=='1'}  checked="checked" {/if}/>
				</td>
				</tr>
	
			<tr>
				<td>SMS Update</td>
				<td><input type="checkbox"  name="sms_update"  id="sms_updateId" value="1" {if $actionReturn.data.sms_update=='1'} checked="checked"  {/if}/> </td>
			</tr>
				<td>&nbsp;</td>
				<td>
				{if $obj->currentAction	==	"Editform"}
					{if $obj->permissionCheck("Edit")}
					<input type="submit" class="butsubmit" valcheck="true"  name="actionvar" value="Update" id="saveDataId" />
					{/if}
				{/if}
					<input type="submit" class="butsubmit"  name="actionvar" value="Cancel" id="cancelId" />
				</td>
			</tr>
		</table>
	</td>
</tr>
{/if}	


{if ($obj->currentAction	==	"Viewform")}
<tr>
	<td>&nbsp;</td>
</tr>
<tr>
	<td>
		<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="formTable">
		
		<tr>
		<td width="50%">
			<div class="boxList">
				
					<div>
						<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="listTablePopUp">
						<tr>
							<th colspan="3" >Customer Personal Profile</th>
							</tr>
							{if $actionReturn.data.fname}
							<tr>
								<td>Name</td>
								<td >{$actionReturn.data.fname} {$actionReturn.data.lname}
								</td>
								<td rowspan	="5" valign="top">
											{if $actionReturn.data.image}
											<a  href="../images/customers/{$actionReturn.data.image}" class="highslide" onclick="return hs.expand(this)">
											<img src="../images/customers/thumb/{$actionReturn.data.image}" style="float:right;"/>
											</a>{/if}{$actionReturn.data.description} 
								</td>
							</tr>
							{/if}
								
							{if $actionReturn.data.email}
							<tr>
								<td>Email</td>
								<td >{$actionReturn.data.email}</td>
							</tr>							
							{/if}
							{if $actionReturn.data.password}
								<tr>
									<td>Password</td>
									<td>{$actionReturn.data.password}</td>
								</tr>
							{/if}
							{if $actionReturn.data.mobile}
							<tr>
								<td >Mobile</td>
								<td >{$obj->getUSPhoneDisplay($actionReturn.data.mobile)}</td>
							</tr>
							{/if}			
							<tr>
								<td>SMS Update</td>
								<td>
								{if $actionReturn.data.sms_update == 1}
									<img src="images/active.gif" border="0" title="SMS update is On" alt="SMS update is On"  />
								{else}
									<img src="images/inactive.gif" border="0" title="SMS update is Off" alt="SMS update is Off"  />
								{/if}
								</td>
								
							</tr>
							<tr>
								<td>Email Updates</td>
								<td  >
								{if $actionReturn.data.email_update == 1}
									<img src="images/active.gif" border="0" title="Email update is On" alt="Email update is On"  />
								{else}
									<img src="images/inactive.gif" border="0" title="Email update is Off" alt="Email update is Off"  />
								{/if}
				
								</td>
								
								
							</tr>
							{if $actionReturn.country}
							<tr>
								<td>Country</td>
								<td colspan="2">{$actionReturn.country}</td>
							</tr>
							{/if}
							{if $actionReturn.state}
							<tr>
								<td>State</td>
								<td colspan="2" >{$actionReturn.state}</td>
							</tr>
							{/if}
							{if $actionReturn.data.zip}
							<tr>
								<td>Zip</td>
								<td colspan="2" >{$actionReturn.data.zip}</td>
							</tr>
							{/if}
							<tr>
								<td>Face Book User</td>
								<td colspan="2">
								{if $actionReturn.data.from_fb == "1"}
									<img src="images/active.gif" border="0" title="Face Book User" alt="Face Book User"  />
								{else}
									<img src="images/inactive.gif" border="0" title="Not a Face Book User" alt="Not a Face Book User"  />
								{/if}
								</td>
							</tr>
							{if $actionReturn.fb_id}
							<tr>
								<td>Face book Id</td>
								<td colspan="2">{$actionReturn.data.fb_id}</td>
							</tr>
							{/if}
							{if $actionReturn.ip}
							<tr>
								<td>Joined IP</td>
								<td colspan="2">{$actionReturn.data.ip}</td>
							</tr>
							{/if}
							<tr>
								<td>Status</td>
								<td colspan="2">
								{if $actionReturn.data.status == 1}
									<img src="images/active.gif" border="0" title="Active user" alt="Active user"  />
								{else}
									<img src="images/inactive.gif" border="0" title="Inactive User" alt="Inactive User"  />
								{/if}
								</td>
							</tr>
							{if $actionReturn.data.date_added}
							<tr>
								<td>Joined Date</td>
								<td colspan="2">{$obj->displayDate($actionReturn.data.date_added)}</td>
							</tr>
							{/if}
							{if $actionReturn.data.catData}
							<tr>
								<td>Interested Categories </td>
								<td>
									{foreach from=$actionReturn.data.catData item=cdata name=i}
										{$cdata.category} - {$cdata.subcatlist} 
										<br />
									{/foreach}
								</td>
							</tr>
							{/if}
						</table>
					</div>
					
					<div>
						{if $actionReturn.refdata}
						<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="listTablePopUp">
						<tr>
							<th  colspan="3">Customer Invite Details</th>
						</tr>
						<tr>
							<td><span id="totalrefreral">Total Invited</span></td>
							<td>{$actionReturn.refdata.totalReferal}</td>
							<td ><a target="_blank" class="view-more" href="{$obj->getLink('Linktotalref','',true)}">
							view more
                            </a></td>
						</tr>
						<tr>
							<td><span id="totaljoined">Total Joined</span></td>
							<td>{$actionReturn.refdata.totalJoined}</td>
							<td><a target="_blank" class="view-more" href="{$obj->getLink('Linktotaljnd','',true)}">
                            view more
                            </a></td>
						</tr>
						<tr>
							<td><span id="totalnotjoined">Total Not Joined</span></td>
							<td>{$actionReturn.refdata.totalNotJoined}</td>
							<td><a target="_blank" class="view-more" href="{$obj->getLink('Linktotalnotjnd','',true)}">
                            view more
                            </a></td>
						</tr>
						<tr>
							<td><span id="productiveusers">Productive users</span></td>
							<td colspan="2">{$actionReturn.refdata.productiveUsers}</td>
						 </tr>
						 </table>
						{/if}
					</div>
					
					<div>
						{if $actionReturn.custorders.count}
						<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="listTablePopUp">
						<tr>
							<th  colspan="3">Customer Order Details</th>
						</tr>
						<tr>
							<td>Purchased Deals</td>
							<td>{$actionReturn.custorders.count}</td>
							<td><a target="_blank" class="view-more" href="{$obj->getLink('Linktopurchsdeal','',true)}">
							view more
                            </a></td>
						</tr>
						<tr>
							<td>Coupon Redeemed</td>
							<td>{$actionReturn.custorders.couponRedeemed}</td>
							<td><a target="_blank" class="view-more" href="{$obj->getLink('Linktocouponredmd','',true)}">
							view more
                            </a></td>
						</tr>
						<tr>
							<td>Coupon To Be Redeemed</td>
							<td>{$actionReturn.custorders.couponTobeRedeemed}</td>
							<td><a target="_blank" class="view-more" href="{$obj->getLink('Linktocoupontbredmd','',true)}">
							view more
                            </a></td>
						</tr>
						<tr>
							<td>Coupon Shared</td>
							<td>{$actionReturn.custorders.couponShared}</td>
							<td><a target="_blank" class="view-more" href="{$obj->getLink('Linktocouponshrd','',true)}">
							view more
                            </a></td>
						</tr>
						<tr>
							<td>Total Amount paid</td>
							<td colspan="2">{$actionReturn.custorders.sum}</td>
						</tr>
						</table>
						{/if}
					</div>
					
				</div>
			</td>
			<td>
				<div class="boxList">
					<div>
						{if $actionReturn.sitepoints}
						<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="listTablePopUp">
						<tr>
							<th  colspan="3">Customer SitePoints</th>
							</tr>
						<tr>
							<td><span id="totalsitepoint">Total site Points</span></td>
							<td colspan="2">{$actionReturn.sitepoints.total_points}</td>
						 </tr>
						<tr>
							<td><span id="balancesitepoint">Balance Site Points</span></td>
							<td colspan="2">{$actionReturn.sitepoints.balance_points}</td>
						 </tr>
						<tr>
							<td><span id="usedsitepoints">Used Site Points</span></td>
							<td>{$actionReturn.sitepoints.used_points}</td>
							<td><a target="_blank" class="view-more" href="{$obj->getLink('Linktositepoints','',true)}">
							view more
                            </a></td>
						</tr>
						</table>
						{/if}

					</div>
					<div>
						{if $actionReturn.sitecredit}
						<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="listTablePopUp">
						<tr>
							<th  colspan="3">Customer SiteCredits</th>
							</tr>
						<tr>
							<td><span id="totalcredit">Total Credit</span> </td>
							<td colspan="2">{$actionReturn.sitecredit.total_credit}</td>
						</tr>
						<tr>
							<td><span id="usedcredit">Used Credit</span></td>
							<td colspan="2">{$actionReturn.sitecredit.used_credit}</td>
						</tr>
						<tr>
							<td><span id="balancedcredit">Balance Credit</span></td>
							<td colspan="2">{$actionReturn.sitecredit.balance_credit}</td>
						</tr>
						<tr>
							<td>Date Updated</td>
							<td>{$actionReturn.sitecredit.date_updated}</td>
							<td><a target="_blank"  class="view-more" href="{$obj->getLink('Linktositecredits','',true)}">
							view more
                            </a></td>
						 </tr>
						 </table>
						{/if}
					</div>
					<div>
						{if $actionReturn.vote}
						<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="listTablePopUp">
						<tr>
							<th  colspan="3">Customer Votes</th>
							</tr>
						<tr>
							<td><span id="totalvoteddeal">Total Voted Deals</span></td>
							<td colspan="2">{$actionReturn.vote.totalVotdDeal}</td>
						</tr>
						<tr>
							<td><span id="votedandpurchsed">Voted and Purchased</span></td>
							<td colspan="2">{$actionReturn.vote.VotdPurchsd}</td>
						</tr>
						<tr>
						  <td><span id="voednotpurchased">Voted Not Purchased</span></td>
						  <td>{$actionReturn.vote.VotdNotPurchsd}</td>
							<td><a target="_blank" class="view-more" href="{$obj->getLink('Linktovotes','',true)}">
							view more
                            </a></td>
						</tr>
						</table>
						{/if}
					
					</div>
					<div>
						{if $actionReturn.ecomData}
						<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="listTablePopUp">
						<tr>
							<th  colspan="3">Customer E-commerce Orders</th>
							</tr>
						<tr>
							<td> Total number of orders </td>
							<td colspan="2">{$actionReturn.ecomData.count}</td>
						</tr>
						<tr>
						  <td>Total amount spent </td>
						  <td>{$actionReturn.ecomData.sum}</td>
							<td><a target="_blank" class="view-more" href="{$obj->getLink('LinktoecomData','',true)}">
							view more
                            </a></td>
						</tr>
						</table>
						{/if}
					
					</div>
					<div>
						{if $actionReturn.questncount}
						<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="listTablePopUp">
						<tr>
							<th  colspan="3">Customer Questionnaire Details</th>
							</tr>
						<tr>
							<td width="170"> Attended Questions</td>
							<td>{$actionReturn.questncount}</td>
							<td><a target="_blank" class="view-more" href="{$obj->getLink('Linktoquestionnaire','',true)}">
							view more
                            </a></td>
						</tr>
						</table>
						{/if}
					</div>
					<div>
						{if $actionReturn.tot_ref}
						<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="listTablePopUp">
						<tr>
							<th  colspan="3">Customer Referals</th>
							</tr>
						<tr>
							<td width="170"> Total Referals</td>
							<td>{$actionReturn.tot_ref}</td>
							<td></td>
						</tr>
						</table>
						{/if}
					</div>
			</div>
		</td>
		</tr>
		<tr>
		<td></td>
			<td >
				<input type="submit" class="butsubmit"  name="actionvar" value="Back" id="cancelId" />
			</td>
		</tr>
		</table>
	</td>
</tr>
{/if}	

<tr>
	{if $obj->currentAction	==	"Listing"}
	<td>
		<table cellpadding="0" cellspacing="0" border="0" width="100%">
			{include file='customerSearch.tpl'}
			{if $actionReturn.data}
			<tr>
				<td align="center" valign="middle">
					<table width="100%" border="0" cellpadding="0" cellspacing="0" class="listTable">
						<tr align="center" valign="middle">							
							<th>No</th>
							<th colspan="2"><a href="{$obj->getLink('search','','false')}&sortField=fullname&sortMethod={$obj->getNegativeSort($actionReturn.searchdata.sortData.sortMethod)}">
							Customer Name
							{$obj->getSortImage('fullname',$actionReturn.searchdata.sortData.sortField,$actionReturn.searchdata.sortData.sortMethod)}				
							</a></th>
							<th><a href="{$obj->getLink('search','','false')}&sortField=email&sortMethod={$obj->getNegativeSort($actionReturn.searchdata.sortData.sortMethod)}">
							Email
							{$obj->getSortImage('email',$actionReturn.searchdata.sortData.sortField,$actionReturn.searchdata.sortData.sortMethod)}
							</a></th>
							<th><a href="{$obj->getLink('search','','false')}&sortField=mobile&sortMethod={$obj->getNegativeSort($actionReturn.searchdata.sortData.sortMethod)}">
							Mobile
							{$obj->getSortImage('mobile',$actionReturn.searchdata.sortData.sortField,$actionReturn.searchdata.sortData.sortMethod)} 
							 </a></th>	
							<th>Status</a></th>	
                            <th><a href="{$obj->getLink('search','','false')}&sortField=date_added&sortMethod={$obj->getNegativeSort($actionReturn.searchdata.sortData.sortMethod)}">
							Added Date
							{$obj->getSortImage('date_added',$actionReturn.searchdata.sortData.sortField,$actionReturn.searchdata.sortData.sortMethod)} 
							 </a></th>						
							<th>Action </th>
						</tr>
					{foreach from=$actionReturn.data item=data name=i}
						<tr>
							<td>{$actionReturn.spage->startingRow+$smarty.foreach.i.index}</td>
							<td colspan="2">{$data.fullname}</td>
							<td>{$data.email}</td>
							<td>{$data.mobile}</td>
                            <td>{if $data.status == 1} <img src="images/active.gif" border="0" title="Active User">{else}<img src="images/inactive.gif" border="0" title="Inactive User">{/if}</td>
                            <td>{$obj->displayDate($data.date_added)}</td>
							<td>
							{if $obj->permissionCheck("Status")}
					<a href="{$obj->getLink('Stauschange','',true,$obj->getConcat('id=',$data.id))}" class="Second_link">
					{/if}
							{if $data.status == 1} 
							<img src="images/active.gif" border="0" title="Click here to inactivate">
							 {else} 							 
							 <img src="images/inactive.gif" border="0" title="Click here to activate">
							 {/if}
					{if $obj->permissionCheck("Status")}
					 </a> 
					{/if}
							{if $obj->permissionCheck("View")}
							<a href="{$obj->getLink('viewform','',true,$obj->getConcat('id=',$data.id))}" class="Second_link">
							<img src="images/view.gif" border="0" title="Click here to view"> </a>
							{/if}
							{if $obj->permissionCheck("Edit")}
							<a href="{$obj->getLink('editform','',true,$obj->getConcat('id=',$data.id))}" class="Second_link">
							<img src="images/edit.gif" border="0" title="Click here to edit"></a> 
							{/if}
							{if $obj->permissionCheck("Delete")}
							<a href="{$obj->getLink('deleteform','',true,$obj->getConcat('id=',$data.id))}" class="Second_link">
							<img src="images/delete.gif" border="0" title="Click here to delete"> </a>
							{/if}
							{if $data.status == 1} 
							  <span title="Already activated this account">---</span>
							{else}
							<a href="{$obj->getLink('Sendmail','',true,$obj->getConcat('id=',$data.id))}" class="Second_link">
							<img src="images/reply_icon.gif" border="0" title="Click here to send activation mail to {$data.fullname}"> 
							</a>
							{/if}
							</td>
						</tr>
					{/foreach}
					<tr>
						<td></td>
						<td colspan="8">{$actionReturn.spage->s_get_links()}</td>
					</tr>
				</table>
				</td>
			</tr>
		{/if}
		
		</table>
	</td>
	{/if}
</tr>
</table>
{include_php file="footer.php"}
